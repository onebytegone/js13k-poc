AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},walkAcceleration:{default:65},runAcceleration:{default:220}},init:function(){this.easing=1.1,this.velocity=new THREE.Vector3,this.inputs={},document.addEventListener("keypress",(function(t){document.getElementById("camera").components["wasd-controls"].data.acceleration=t.shiftKey?220:65})),this.onInputDown=this.onInputDown.bind(this),this.onInputUp=this.onInputUp.bind(this)},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.pause()},addEventListeners:function(){document.querySelectorAll(".on-screen-controls button").forEach(t=>{t.addEventListener("mousedown",this.onInputDown),t.addEventListener("touchstart",this.onInputDown),t.addEventListener("mouseup",this.onInputUp),t.addEventListener("touchend",this.onInputUp),t.addEventListener("touchcancel",this.onInputUp)})},removeEventListeners:function(){document.querySelectorAll(".on-screen-controls button").forEach(t=>{t.removeEventListener("mousedown",this.onInputDown),t.removeEventListener("touchstart",this.onInputDown),t.removeEventListener("mouseup",this.onInputUp),t.removeEventListener("touchend",this.onInputUp),t.removeEventListener("touchcancel",this.onInputUp)})},onInputDown:function(t){this.inputs[t.target.dataset.input]=!0,t.preventDefault()},onInputUp:function(t){delete this.inputs[t.target.dataset.input],t.preventDefault()},tick:function(t,e){var n=this.data,o=this.velocity;n.enabled&&(e/=1e3,this.updateVelocity(e),o.z&&this.el.object3D.position.add(this.getMovementVector(e)))},updateVelocity:function(t){var e,n=this.data,o=this.velocity;if(t>.2)o.z=0;else{var i=Math.pow(1/this.easing,60*t);0!==o.z&&(o.z-=o.z*i),Math.abs(o.z)<1e-5&&(o.z=0),e=this.inputs.run?n.runAcceleration:n.walkAcceleration,(this.inputs.walk||this.inputs.run)&&(o.z-=e*t)}},getMovementVector:function(){var t=new THREE.Vector3(0,0,0),e=new THREE.Euler(0,0,0,"YXZ");return function(n){const o=this.el.getAttribute("rotation"),i=this.velocity;return t.copy(i),t.multiplyScalar(n),o?(e.set(0,THREE.Math.degToRad(o.y),0),t.applyEuler(e),t):t}}()}),document.addEventListener("keypress",(function(t){document.getElementById("camera").components["wasd-controls"].data.acceleration=t.shiftKey?220:65}));