let collidableObjects=[];function makeWallEl(t){const e=document.createElement("a-box");return e.setAttribute("width",t),e.setAttribute("height","4"),e.setAttribute("depth","0.25"),e.setAttribute("color","#ededea"),e.setAttribute("collidable",""),e}function createWall(t,e,n,o){if("gap"===o)return;const i=document.querySelector("a-scene");let a=0,s=0;if(0===n?(a=0,s=-4):1===n?(a=4,s=0):2===n?(a=0,s=4):(a=-4,s=0),"door"===o){const o=makeWallEl("2.5");sideB=makeWallEl("2.5"),o.setAttribute("position",`${8*t+a+(n+1)%2*2.75} 2 ${8*e+s+n%2*2.75}`),o.setAttribute("rotation",`0 ${n%2*90} 0`),i.appendChild(o),sideB.setAttribute("position",`${8*t+a+(n+1)%2*-2.75} 2 ${8*e+s+n%2*-2.75}`),sideB.setAttribute("rotation",`0 ${n%2*90} 0`),i.appendChild(sideB)}else{const o=makeWallEl("8");o.setAttribute("position",`${8*t+a} 2 ${8*e+s}`),o.setAttribute("rotation",`0 ${n%2*90} 0`),i.appendChild(o)}}function createFloor(t,e){const n=document.createElement("a-plane"),o=document.querySelector("a-scene"),i=8*t,a=8*e;n.setAttribute("position",`${i/2-4} 0 ${a/2-4}`),n.setAttribute("width",i),n.setAttribute("height",a),n.setAttribute("color","#efa0e0"),n.setAttribute("rotation","-90 0 0"),o.appendChild(n)}AFRAME.registerComponent("collidable",{init:function(){this.bounds=new THREE.Box3,collidableObjects.push(this)},update:function(){this.bounds.setFromObject(this.el.object3D)}}),AFRAME.registerComponent("collider",{schema:{radius:{default:1}},init:function(){this.lastPosition=this.el.object3D.position.clone()},tick:function(){const t=this.el.object3D.position,e=this.data.radius;collidableObjects.find(n=>n.bounds&&t.x+e>n.bounds.min.x&&t.x-e<n.bounds.max.x&&t.z+e>n.bounds.min.z&&t.z-e<n.bounds.max.z)?t.copy(this.lastPosition):this.lastPosition.copy(t)}}),u=l=d=r=s=0,onkeydown=onkeyup=t=>{top["lld*rlurdu"[t.which%32%17]]=t.type[5],s=t.shiftKey},document.onreadystatechange=function(){if("complete"!==document.readyState)return;const t=t=>e=>{e.target.dataset.inputs.split(",").forEach(e=>{top[e]=t}),e.preventDefault()};document.querySelectorAll(".on-screen-controls button").forEach(e=>{e.addEventListener("mousedown",t(!0)),e.addEventListener("touchstart",t(!0)),e.addEventListener("mouseup",t()),e.addEventListener("touchend",t()),e.addEventListener("touchcancel",t())})},AFRAME.registerComponent("movement",{schema:{walk:{default:65},run:{default:220}},init:function(){this.camera=this.el,this.easing=1.1,this.velocity=new THREE.Vector3},tick:function(t,e){const n=this.velocity;e/=1e3,this.updateVelocity(e),(n.x||n.z)&&this.el.object3D.position.add(this.getMovementVector(e))},updateVelocity:function(t){const e=this.velocity;if(t>.2)return e.x=0,void(e.z=0);const n=Math.pow(1/this.easing,60*t);0!==e.x&&(e.x-=e.x*n),0!==e.z&&(e.z-=e.z*n),Math.abs(e.x)<1e-5&&(e.x=0),Math.abs(e.z)<1e-5&&(e.z=0);const o=s?this.data.run:this.data.walk;(u||d)&&(e.z+=o*t*(u?-1:1)),(l||r)&&(e.x+=o*t*(l?-1:1))},getMovementVector:function(){var t=new THREE.Vector3(0,0,0),e=new THREE.Euler(0,0,0,"YXZ");return function(n){const o=this.camera.getAttribute("rotation"),i=this.velocity;return t.copy(i),t.multiplyScalar(n),o?(e.set(0,THREE.Math.degToRad(o.y),0),t.applyEuler(e),t):t}}()});const PRNG=function(t){return{next:function(){return(t=(9301*t+49297)%233280)/233280},between:function(t,e,n){const o=t+this.next(n)*(e-t);return n?Math.round(o):o}}};function generateMap(t,e,n){const o=["gap","wall","door"];return[...Array(n).keys()].map(n=>[...Array(e).keys()].map(e=>({N:0===n?"wall":o[t.between(0,2,!0)],W:0===e?"wall":o[t.between(0,2,!0)]})))}function renderMap(t){const e=t.length,n=t[0].length;createFloor(e,n),t.forEach((t,e)=>{t.forEach((t,n)=>{createWall(n,e,0,t.N),createWall(n,e,3,t.W)}),createWall(n,e,3,"wall")}),t[0].forEach((t,n)=>{createWall(n,e,0,"wall")})}window.onload=()=>{const t=Math.floor(100*Math.random()),e=generateMap(PRNG(t),10,10);console.log(t),renderMap(e)};