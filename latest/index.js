let t=[];var e,n;function o(t){const e=document.createElement("a-box");return e.setAttribute("width",t),e.setAttribute("height","4"),e.setAttribute("depth","0.25"),e.setAttribute("color","#ededea"),e.setAttribute("collidable",""),e}function i(t,e,n,i){if("gap"===i)return;const s=document.querySelector("a-scene");let r=0,a=0;if(0===n?(r=0,a=-4):1===n?(r=4,a=0):2===n?(r=0,a=4):(r=-4,a=0),"door"===i){const i=o("2.5");sideB=o("2.5"),i.setAttribute("position",`${8*t+r+(n+1)%2*2.75} 2 ${8*e+a+n%2*2.75}`),i.setAttribute("rotation",`0 ${n%2*90} 0`),s.appendChild(i),sideB.setAttribute("position",`${8*t+r+(n+1)%2*-2.75} 2 ${8*e+a+n%2*-2.75}`),sideB.setAttribute("rotation",`0 ${n%2*90} 0`),s.appendChild(sideB)}else{const i=o("8");i.setAttribute("position",`${8*t+r} 2 ${8*e+a}`),i.setAttribute("rotation",`0 ${n%2*90} 0`),s.appendChild(i)}}function a(t,e,n,o,i){if(i<3)return;const s=2*Math.PI/i;t.beginPath(),t.translate(e,n),t.moveTo(o,0);for(let e=1;e<i;e++)t.lineTo(o*Math.cos(s*e),o*Math.sin(s*e));t.closePath(),t.translate(-e,-n)}AFRAME.registerComponent("collidable",{init:function(){this.bounds=new THREE.Box3,t.push(this)},update:function(){this.bounds.setFromObject(this.el.object3D)}}),u=l=d=r=s=0,onkeydown=onkeyup=t=>{top["lld*rlurdu"[t.which%32%17]]=t.type[5],s=t.shiftKey},document.onreadystatechange=function(){if("complete"!==document.readyState)return;const t=t=>e=>{e.target.dataset.inputs.split(",").forEach(e=>{top[e]=t}),e.preventDefault()};document.querySelectorAll(".on-screen-controls button").forEach(e=>{e.addEventListener("mousedown",t(!0)),e.addEventListener("touchstart",t(!0)),e.addEventListener("mouseup",t()),e.addEventListener("touchend",t()),e.addEventListener("touchcancel",t())})},AFRAME.registerComponent("movement",{schema:{walk:{default:65},run:{default:220},radius:{default:1},camera:{default:""}},init:function(){this.camera=this.data.camera?document.getElementById(this.data.camera):this.el,this.easing=1.1,this.velocity=new THREE.Vector3},tick:function(e,n){const o=this.velocity;if(this.updateVelocity(n/=1e3),!o.x&&!o.z)return;const i={x:100*this.el.object3D.position.x,y:100*this.el.object3D.position.z,radius:100*this.data.radius},s=new THREE.Vector3(0,0,0);s.copy(this.el.object3D.position).add(this.getMovementVector(n));const r={x:100*s.x,y:100*s.z};t.forEach(t=>{if(t.bounds&&(collision=function(t,e,n){if(t.x===e.x&&t.y===e.y)return;const o=t.radius,i=t.y-o,s=t.x+o,r=t.y+o,a=t.x-o,c=e.y-o,l=e.x+o,u=e.y+o,d=e.x-o,h=n.n,y=n.e,f=n.s,x=n.w;if(!(Math.max(s,l)>x&&Math.min(a,d)<y&&Math.max(r,u)>h&&Math.min(i,c)<f))return;const p=e.x-t.x,m=e.y-t.y,b=0===p?0:1/p,E=0===m?0:1/m;let g,M;if(a<x&&l>x){const e=(x-s)*b;if(e>=0&&e<=1){const n=t.y+m*e;if(n>=h&&n<=f)return{t:e,x:t.x+p*e,y:n,nx:-1,ny:0}}g=x}if(s>y&&d<y){const e=(y-a)*b;if(e>=0&&e<=1){const n=t.y+m*e;if(n>=h&&n<=f)return{t:e,x:t.x+p*e,y:n,nx:1,ny:0}}g=y}if(i<h&&u>h){const e=(h-r)*E;if(e>=0&&e<=1){const n=t.x+p*e;if(n>=x&&n<=y)return isColliding=!0,{t:e,x:n,y:t.y+m*e,nx:0,ny:-1}}M=h}if(r>f&&c<f){const e=(f-i)*E;if(e>=0&&e<=1){const n=t.x+p*e;if(n>=x&&n<=y)return{t:e,x:n,y:t.y+m*e,nx:0,ny:1}}M=f}if(void 0===g&&void 0===M)return;void 0!==g&&void 0===M?M=m>0?f:h:void 0!==M&&void 0===g&&(g=p>0?y:x);const w=1/o,A=Math.sqrt(p*p+m*m),v=g-t.x,z=M-t.y,$=Math.sqrt(v*v+z*z);if(innerAngle=Math.acos((v*p+z*m)/(A*$)),$<o)return;if(0===innerAngle){const e=($-o)/A;if(e>1||e<0)return;return{t:e,x:t.x+p*e,y:t.y+m*e,nx:v/$,ny:z/$}}const k=Math.sin(innerAngle),R=k*$*w;if(Math.abs(R)>1)return;const T=Math.PI-innerAngle-(Math.PI-Math.asin(R)),C=o*Math.sin(T)/k/A;return C>1||C<0?void 0:{t:C,x:t.x+p*C,y:t.y+m*C,nx:(C*p+t.x-g)*w,ny:(C*m+t.y-M)*w}}(i,r,{n:100*t.bounds.min.z,s:100*t.bounds.max.z,e:100*t.bounds.max.x,w:100*t.bounds.min.x}),collision)){const t=1-collision.t,e=r.x-i.x,n=r.y-i.y,o=e*collision.nx+n*collision.ny,s=e-2*o*collision.nx,a=n-2*o*collision.ny;r.x=collision.x+s*t,r.y=collision.y+a*t}}),s.x=r.x/100,s.z=r.y/100,this.el.object3D.position.copy(s)},updateVelocity:function(t){const e=this.velocity;if(t>.2)return e.x=0,void(e.z=0);const n=Math.pow(1/this.easing,60*t);0!==e.x&&(e.x-=e.x*n),0!==e.z&&(e.z-=e.z*n),Math.abs(e.x)<1e-5&&(e.x=0),Math.abs(e.z)<1e-5&&(e.z=0);const o=s?this.data.run:this.data.walk;(u||d)&&(e.z+=o*t*(u?-1:1)),(l||r)&&(e.x+=o*t*(l?-1:1))},getMovementVector:(e=new THREE.Vector3(0,0,0),n=new THREE.Euler(0,0,0,"YXZ"),function(t){const o=this.camera.getAttribute("rotation");return e.copy(this.velocity),e.multiplyScalar(t),o?(n.set(0,THREE.Math.degToRad(o.y),0),e.applyEuler(n),e):e})}),window.onload=()=>{const t=Math.floor(100*Math.random()),e=function(t,e,n){const o=["gap","wall","door"];return[...[,,,,,,,,,,].keys()].map(e=>[...[,,,,,,,,,,].keys()].map(n=>({N:0===e?"wall":o[t.between(0,2,!0)],W:0===n?"wall":o[t.between(0,2,!0)]})))}(function(t){return{next:function(){return(t=(9301*t+49297)%233280)/233280},between:function(t,e,n){const o=t+this.next(n)*(e-t);return n?Math.round(o):o}}}(t));console.log(t),function(){const t=document.getElementById("floor"),e=t.getContext("2d"),n=t.width,o=t.height;e.fillStyle="#eee",e.fillRect(0,0,n,o),e.strokeStyle="#333",e.lineWidth=1,a(e,0,0,n/2,6),e.stroke(),a(e,n,o,n/2,6),e.stroke(),e.strokeStyle="#aaa",e.strokeRect(0,0,n,o)}(),function(t){const e=t.length,n=t[0].length;!function(t,e){const n=document.createElement("a-plane"),o=document.querySelector("a-scene"),i=8*t,s=8*e;n.setAttribute("position",`${i/2-4} 0 ${s/2-4}`),n.setAttribute("width",i),n.setAttribute("height",s),n.setAttribute("rotation","-90 0 0"),n.setAttribute("material",`src: #floor; repeat: ${1.6*i}, ${1.6*s}`),o.appendChild(n)}(e,n),t.forEach((t,e)=>{t.forEach((t,n)=>{i(n,e,0,t.N),i(n,e,3,t.W)}),i(n,e,3,"wall")}),t[0].forEach((t,n)=>{i(n,e,0,"wall")})}(e)};